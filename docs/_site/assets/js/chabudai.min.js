"use strict";(function($){$.fn.table=function(data,config){var matches=function matches(el,selector){return(el.matches||el.matchesSelector||el.msMatchesSelector||el.mozMatchesSelector||el.webkitMatchesSelector||el.oMatchesSelector).call(el,selector)};if(!this.length){throw".table() called on invalid element"}if(!this.is("table")){throw".table() must be called on table element"}var options=$.extend(true,{headers:data.length?Object.keys(data[0]):null,paginate:10,nav:{items:5,prev:"&lang;",next:"&rang;"}},config);var plugin=this;var nav={el:null,from:0,to:options.nav.items};var editing=null;var keycode={ENTER:13};plugin.addClass("chabudai");plugin.append($("<thead>").append($("<tr>").append($("<th>",{scope:"col"}).html("#"),$.map(options.headers,function(x){return"<th scope=\"col\">"+x+"</th>"}))));plugin.append($("<tbody>").append($.map(data,function(r,i){return $("<tr>").append($("<th>",{scope:"row"}).html(i),Object.values(r).map(function(c){var cell;if(Array.isArray(c)){var options=c.map(function(x){return"<option value=\""+x+"\">"+x+"</option>"}).join("");cell="<select class=\"custom-select\">"+options+"</select>"}else{cell="<input class=\"form-control\" type=\"text\" value=\""+c+"\" readonly></input>"}return"<td>"+cell+"</td>"}))})));var stopEditing=function stopEditing(){if(editing===null){return}if(matches(editing,"td")){var input=editing.firstChild;if(input.tagName==="INPUT"){input.setAttribute("readonly","")}editing.classList.remove("editing","table-primary");editing=null;return}if(matches(editing,"tr")){var _input=editing.querySelector("td textarea");var values=Object.values(JSON.parse(_input.value));editing.removeChild(_input.parentNode);Array.from(editing.getElementsByTagName("td")).forEach(function(td,i){td.style=null;td.firstChild.value=values[i]});editing=null;return}};var startEditing=function startEditing(el){if(matches(el,"td")){editing=el;var input=editing.firstChild;if(input.tagName==="INPUT"){input.focus();input.selectionStart=input.selectionEnd=input.value.length;input.removeAttribute("readonly")}editing.classList.add("editing","table-primary");return}if(matches(el,"th[scope=\"row\"]")){editing=el.parentNode;var cells=Array.from(editing.getElementsByTagName("td"));var values=cells.map(function(el){return el.firstChild.value});var headers=plugin.find("thead th[scope=\"col\"]").get().map(function(el){return el.innerHTML}).slice(1);var map={};headers.forEach(function(h,i){return map[h]=values[i]});cells.forEach(function(el){return el.style.display="none"});$(editing.firstChild).after($("<td>",{"class":"editing table-primary","colspan":cells.length}).append($("<textarea>",{"class":"form-control","rows":cells.length+2}).val(JSON.stringify(map,null,2))));var textarea=editing.querySelector("td textarea");textarea.focus();textarea.selectionStart=textarea.selectionEnd=textarea.value.length}};var pageTo=function pageTo(li){if(nav.el===null){return}var active=nav.el[0].querySelector(".active");if(active){active.classList.remove("active")}li.classList.add("active");var page=li.dataset.page;var rows=plugin[0].querySelector("tbody").getElementsByTagName("tr");for(var i=0;i<rows.length;i++){rows[i].style.display="none"}for(var _i=(page-1)*options.paginate;_i<rows.length&&_i<page*options.paginate;_i++){rows[_i].style.display=null}};var navNext=function navNext(){var items=nav.el.find("li:not(:first-child):not(:last-child)");if(nav.to>=items.length){return}if(nav.from==0){nav.el[0].querySelector("li:first-child").classList.remove("disabled")}nav.from=nav.from+options.nav.items;nav.to=nav.to+options.nav.items;items.each(function(i,el){i>=nav.from&&i<nav.to?el.style=null:el.style.display="none"});if(nav.to>=items.length){nav.el[0].querySelector("li:last-child").classList.add("disabled")}};var navPrev=function navPrev(){var items=nav.el.find("li:not(:first-child):not(:last-child)");if(nav.from==0){return}if(nav.to>=items.length){nav.el[0].querySelector("li:last-child").classList.remove("disabled")}nav.from=nav.from-options.nav.items;nav.to=nav.to-options.nav.items;items.each(function(i,el){i>=nav.from&&i<nav.to?el.style=null:el.style.display="none"});if(nav.from==0){nav.el[0].querySelector("li:first-child").classList.add("disabled")}};var clickInside=function clickInside(e){if(plugin[0].contains(e.target)){plugin[0].removeEventListener("click",clickInside);document.addEventListener("click",clickOutside)}};var clickOutside=function clickOutside(e){if(!plugin[0].contains(e.target)){stopEditing();document.removeEventListener("click",clickOutside);plugin[0].addEventListener("click",clickInside)}};plugin[0].addEventListener("click",clickInside);plugin.on("click","td:not(.editing), th[scope=\"row\"]",function(e){stopEditing();startEditing(this)});plugin.on("keypress","td.editing",function(e){if(e.which==keycode.ENTER){stopEditing()}});plugin.on("click","th[scope=\"col\"]",function(e){stopEditing();var index=Array.from(this.parentNode.children).indexOf(this);var column=plugin[0].querySelectorAll("td:nth-child("+(index+1)+")");for(var i=0;i<column.length;i++){column[i].classList.toggle("selected");column[i].classList.toggle("table-primary")}});plugin.appendTo(plugin);if(data.length>10&&options.paginate!==false){var total=Math.ceil(data.length/10);var items=Array.from(Array(total),function(_,i){return"<li class=\"page-item\" data-page=\""+(i+1)+"\"><a class=\"page-link\">"+(i+1)+"</a></li>"});nav.el=$("<nav>").append($("<ul>",{"class":"pagination justify-content-center"}).append(items.join("")));if(items.length>options.nav.items){nav.el.find("li:nth-child(n + "+(1+options.nav.items)+"):nth-child(-n + "+items.length+")").css("display","none");nav.el.find(".pagination").prepend("<li class=\"page-item disabled\"><a class=\"page-link\">"+options.nav.prev+"</a></li>");nav.el.find(".pagination").append("<li class=\"page-item\"><a class=\"page-link\">"+options.nav.next+"</a></li>");nav.el.on("click","li:first-child",function(e){navPrev()});nav.el.on("click","li:last-child",function(e){navNext()})}nav.el.on("click","li[data-page]:not(.active)",function(e){e.preventDefault();pageTo(this)});plugin.after(nav.el);pageTo(nav.el[0].querySelector("li[data-page=\"1\"]"))}return plugin}})(jQuery);
"use strict";if(!Array.from){Array.from=function(){var toStr=Object.prototype.toString;var isCallable=function isCallable(fn){return typeof fn==="function"||toStr.call(fn)==="[object Function]"};var toInteger=function toInteger(value){var number=Number(value);if(isNaN(number)){return 0}if(number===0||!isFinite(number)){return number}return(number>0?1:-1)*Math.floor(Math.abs(number))};var maxSafeInteger=Math.pow(2,53)-1;var toLength=function toLength(value){var len=toInteger(value);return Math.min(Math.max(len,0),maxSafeInteger)};return function from(arrayLike){var C=this;var items=Object(arrayLike);if(arrayLike==null){throw new TypeError("Array.from requires an array-like object - not null or undefined")}var mapFn=arguments.length>1?arguments[1]:void undefined;var T;if(typeof mapFn!=="undefined"){if(!isCallable(mapFn)){throw new TypeError("Array.from: when provided, the second argument must be a function")}if(arguments.length>2){T=arguments[2]}}var len=toLength(items.length);var A=isCallable(C)?Object(new C(len)):new Array(len);var k=0;var kValue;while(k<len){kValue=items[k];if(mapFn){A[k]=typeof T==="undefined"?mapFn(kValue,k):mapFn.call(T,kValue,k)}else{A[k]=kValue}k+=1}A.length=len;return A}}()}
